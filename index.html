<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyTube - Video Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0f0f0f;
            color: white;
            font-family: Arial, sans-serif;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0;
            padding: 12px 24px;
            background: #0f0f0f;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .logo h1 {
            margin: 0;
            color: white;
        }

        .logo span {
            color: #ff4444;
        }

        .logo .tagline {
            font-style: italic;
            color: #00b7ff;
            font-size: 0.7em;
            margin-top: 4px;
        }

        .search-bar {
            display: flex;
            gap: 10px;
        }

        .search-bar input {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: #1f1f1f;
            color: white;
        }

        .search-bar button {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            background: #ff4444;
            color: white;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            transition: background-color 0.3s;
        }

        .nav-links a:hover,
        .nav-links a.active {
            background: rgba(255,255,255,0.1);
        }

        .coffee-btn {
            background: #ffdd00 !important;
            color: #000 !important;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s !important;
        }

        .coffee-btn:hover {
            transform: scale(1.05);
            background: #ffdd00 !important;
        }

        .coffee-btn span {
            font-size: 20px;
        }

        .video-grid {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .video-card {
            background: #1f1f1f;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .video-card:hover {
            transform: translateY(-4px);
        }

        .video-card iframe {
            width: 100%;
            height: 200px;
            border: none;
        }

        .video-card video {
            width: 100%;
            display: block;
            background: black;
        }

        .video-info {
            padding: 12px;
        }

        .video-info h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
            font-weight: 500;
        }

        .video-info p {
            margin: 0 0 8px 0;
            color: #aaa;
            font-size: 14px;
        }

        .video-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            color: #aaa;
            font-size: 13px;
        }

        .category {
            background: #ff4444;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .disclaimer {
            background: #1f1f1f;
            padding: 40px 20px;
            margin-top: 40px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            color: #ff4444;
            margin: 0 0 16px 0;
        }

        .footer-section p {
            color: #aaa;
            margin: 8px 0;
            font-size: 14px;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #666;
            font-size: 12px;
        }

        .section {
            display: none;
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 24px;
        }

        .section-header h2 {
            font-size: 24px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-header p {
            color: #aaa;
            margin: 8px 0 0 0;
        }

        .library-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .library-section {
            background: #1f1f1f;
            border-radius: 12px;
            padding: 16px;
        }

        .library-section h3 {
            margin: 0 0 16px 0;
            color: #ff4444;
        }

        .video-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .empty-message {
            color: #666;
            text-align: center;
            padding: 32px;
        }

        .clear-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 16px;
        }

        .clear-btn:hover {
            background: #ff2222;
        }

        .trending-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .video-controls {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .control-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border: none;
            border-radius: 20px;
            background: #2f2f2f;
            color: #aaa;
            cursor: pointer;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #3f3f3f;
            color: white;
        }

        .control-btn.active {
            background: #ff4444;
            color: white;
        }

        .control-btn i {
            font-size: 14px;
        }

        #ad-container {
            position: relative;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to right, #1f1f1f, #2a2a2a);
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            margin: 20px auto;
            max-width: 800px;
            z-index: 1;
        }

        .ad-link {
            display: inline-block;
            text-decoration: none;
            color: #00b7ff;
            padding: 8px 16px;
            background: rgba(0,0,0,0.2);
            border-radius: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
            margin: 10px 0;
        }

        .ad-link:hover {
            background: rgba(0,0,0,0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 183, 255, 0.2);
        }

        .ad-banner {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            text-align: center;
            padding: 12px;
            background: linear-gradient(to right, #1f1f1f, #2a2a2a);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .ad-banner .ad-link {
            display: inline-block;
            text-decoration: none;
            color: #00b7ff;
            padding: 8px 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .ad-banner .ad-link:hover {
            background: rgba(0,0,0,0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 183, 255, 0.2);
        }

        @media screen and (max-width: 768px) {
            #ad-container, .ad-banner {
                margin: 15px 10px;
                padding: 10px;
            }
        }

        @media screen and (max-width: 1200px) {
            .ad-sidebar {
                display: none;
            }
        }
    </style>
    <!-- Ad configuration -->
    <script type="text/javascript">
        atOptions = {
            'key' : '41b248193d36880a522911972d084a13',
            'format' : 'iframe',
            'height' : 600,
            'width' : 160,
            'params' : {}
        };
    </script>
</head>
<body>
    <nav>
        <div class="logo">
            <h1>My<span>Tube</span></h1>
            <div class="tagline">Para Ed Saray Taga Pangasinan Ya!</div>
        </div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search videos..." oninput="filterVideos()">
            <button onclick="filterVideos()">Search</button>
        </div>
        <div class="nav-links">
            <a href="#" onclick="showSection('home')" class="active" data-section="home">Home</a>
            <a href="#" onclick="showSection('trending')" data-section="trending">Trending</a>
            <a href="#" onclick="showSection('library')" data-section="library">Library</a>
            <a href="#" onclick="showSection('history')" data-section="history">History</a>
            <a href="https://buymeacoffee.com/musikalangw" target="_blank" class="coffee-btn">
                <span>☕</span> Buy Rod a coffee
            </a>
        </div>
    </nav>

    <div id="home" class="section active">
        <div class="ad-banner">
            <a href="https://www.effectiveratecpm.com/u5cqbjar?key=0b5c8ec91ad0d06f66adb08b7402e5f8" target="_blank" class="ad-link">Check Out Our Sponsors</a>
        </div>
        <div class="video-grid"></div>
    </div>

    <script type="text/javascript">
        atOptions = {
            'key' : '41b248193d36880a522911972d084a13',
            'format' : 'iframe',
            'height' : 600,
            'width' : 160,
            'params' : {}
        };
        document.write('<scr' + 'ipt type="text/javascript" src="//www.highperformanceformat.com/41b248193d36880a522911972d084a13/invoke.js"></scr' + 'ipt>');
    </script>

    <div id="trending" class="section">
        <div class="section-header">
            <h2>🔥 Trending Now</h2>
            <p>Watch what's hot right now</p>
        </div>
        <div class="trending-grid">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <div id="library" class="section">
        <div class="section-header">
            <h2>📚 Your Library</h2>
        </div>
        <div class="library-content">
            <div class="library-section">
                <h3>Watch Later</h3>
                <div id="watchLater" class="video-list">
                    <p class="empty-message">No videos added to Watch Later</p>
                </div>
            </div>
            <div class="library-section">
                <h3>Liked Videos</h3>
                <div id="likedVideos" class="video-list">
                    <p class="empty-message">No liked videos yet</p>
                </div>
            </div>
        </div>
    </div>

    <div id="history" class="section">
        <div class="section-header">
            <h2>⏰ Watch History</h2>
            <button onclick="clearHistory()" class="clear-btn">Clear History</button>
        </div>
        <div id="watchHistory" class="video-list">
            <p class="empty-message">No watch history</p>
        </div>
    </div>

    <footer class="disclaimer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About MyTube</h3>
                <p>A video sharing platform for educational and entertainment purposes.</p>
            </div>
            <div class="footer-section">
                <h3>Legal</h3>
                <p>This website is for demonstration purposes only.</p>
                <p>All content belongs to their respective owners.</p>
                <p>If you believe your copyright has been violated, please contact us.</p>
            </div>
            <div class="footer-section">
                <h3>Contact</h3>
                <p>Email: support@mytube.com</p>
                <p>Follow us on social media</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 MyTube. All rights reserved.</p>
        </div>
    </footer>

    <!-- Ad container moved to bottom -->
    <div id="ad-container">
        <script type="text/javascript">
            atOptions = {
                'key' : '41b248193d36880a522911972d084a13',
                'format' : 'iframe',
                'height' : 90,
                'width' : 728,
                'params' : {}
            };
            document.write('<scr' + 'ipt type="text/javascript" src="http' + (location.protocol === 'https:' ? 's' : '') + '://www.effectiveratecpm.com/41b248193d36880a522911972d084a13/invoke.js"></scr' + 'ipt>');
        </script>
        <a href="https://www.effectiveratecpm.com/u5cqbjar?key=0b5c8ec91ad0d06f66adb08b7402e5f8" target="_blank" class="ad-link">Advertise Here</a>
    </div>

    <script>
        const videos = [
            {
                "id": "x3fjb7y",
                "title": "FPJ Action Movie",
                "type": "embed",
                "embedUrl": "https://www.dailymotion.com/embed/video/x3fjb7y",
                "description": "Classic FPJ Action Movie",
                "category": "Movie",
                "views": "0",
                "trending": false
            },
            {
                "id": "21",
                "title": "Doraemon Title Song (Japanese)",
                "type": "cloudflare",
                "videoId": "f8c5450869361bf546fec0107b99aef2",
                "description": "The original Japanese opening theme song of Doraemon",
                "category": "Anime",
                "views": "0",
                "trending": false
            },
            {
                "id": "20",
                "title": "Bread - Fav5 Hits",
                "type": "cloudflare",
                "videoId": "7672cc2de699fde9f7f342a537dbf45b",
                "description": "Top 5 favorite hits from the legendary band Bread",
                "category": "Music",
                "views": "0",
                "trending": false
            },
            {
                "id": "19",
                "title": "Sarah Geronimo - Maybe This Time",
                "type": "cloudflare",
                "videoId": "a6f818f8a3a6c5197341c5527ea46618",
                "description": "Sarah Geronimo performs 'Maybe This Time'",
                "category": "Music - Pop",
                "views": "88K",
                "trending": true
            },
            {
                "id": "18",
                "title": "Natalie Cole - Starting Over Again",
                "type": "cloudflare",
                "videoId": "0c715820cd492fe54762b45c55cfce38",
                "description": "Official audio of 'Starting Over Again' performed by Natalie Cole",
                "category": "Music - Pop",
                "views": "94K",
                "trending": true
            },
            {
                "id": "17",
                "title": "Angel Baby",
                "type": "cloudflare",
                "videoId": "996f710ddd65d0a9e9dac5d80c73f985",
                "description": "A heartwarming performance of the classic song 'Angel Baby'",
                "category": "Music - Pop",
                "views": "85K",
                "trending": true
            },
            {
                "id": "16",
                "title": "Till My Heartaches End",
                "type": "cloudflare",
                "videoId": "004ac094be3020a6f844e380e07e62a7",
                "description": "A beautiful rendition of 'Till My Heartaches End'",
                "category": "Music - Pop",
                "views": "78K",
                "trending": true
            },
            {
                "id": "15",
                "title": "GINO PADILLA - MILLION MILES AWAY",
                "type": "cloudflare",
                "videoId": "2fffe4e6eaf3e82ad5a26f1763cfbd86",
                "description": "Classic hit 'Million Miles Away' performed by Gino Padilla",
                "category": "Music - Pop",
                "views": "92K",
                "trending": true
            },
            {
                "id": "14",
                "title": "I Just Fall In Love Again - Sarah Geronimo",
                "type": "cloudflare",
                "videoId": "9b1385fe30507c845d2720cddebd7365",
                "description": "Sarah Geronimo performs 'I Just Fall In Love Again'",
                "category": "Music - Pop",
                "views": "89K",
                "trending": true
            },
            {
                "id": "13",
                "title": "The Chasing My Rejected Wife Full",
                "type": "embed",
                "embedUrl": "https://www.dailymotion.com/embed/video/x97igci",
                "description": "The Chasing My Rejected Wife - A compelling story of love and redemption",
                "category": "Movie",
                "views": "142K",
                "trending": true
            },
            {
                "id": "12",
                "title": "My Billionaire Husband Full Movie",
                "type": "embed",
                "embedUrl": "https://www.dailymotion.com/embed/video/x9bao4k",
                "description": "My Billionaire Husband - A romantic story about love and wealth",
                "category": "Movie",
                "views": "156K",
                "trending": true
            },
            {
                "id": "11",
                "title": "After I Sold My Special Service To Billionaire",
                "type": "embed",
                "embedUrl": "https://www.dailymotion.com/embed/video/x9atmqk",
                "description": "After I Sold My Special Service To Billionaire",
                "category": "Movie",
                "views": "128K",
                "trending": true
            },
            {
                "id": "9",
                "title": "Sample Video (External)",
                "url": "https://www.w3schools.com/html/mov_bbb.mp4",
                "description": "Sample video from external source (W3Schools)",
                "category": "Demo",
                "views": "45",
                "trending": false
            },
            {
                "id": "x9bv34s",
                "title": "Playing Time - Philippines Darma",
                "type": "embed",
                "embedUrl": "https://www.dailymotion.com/embed/video/x9bv34s",
                "description": "Late Night Drama series",
                "category": "Movie",
                "views": "0",
                "trending": false
            }
        ];

        let filteredVideos = videos;
        let watchHistory = [];
        let likedVideos = [];
        let watchLater = [];
        let favoriteVideos = [];
        let autoplayEnabled = false;

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Update nav links
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === sectionId) {
                    link.classList.add('active');
                }
            });

            // Update content based on section
            if (sectionId === 'trending') {
                displayTrending();
            } else if (sectionId === 'library') {
                displayLibrary();
            } else if (sectionId === 'history') {
                displayHistory();
            }
        }

        function displayVideos() {
            const videoGrid = document.querySelector('.video-grid');
            videoGrid.innerHTML = filteredVideos.map(video => `
                <div class="video-card">
                    ${video.type === 'embed' ? 
                        `<iframe src="${video.embedUrl}?sharing-enable=false&ui-logo=false&ui-start-screen-info=false" 
                            frameborder="0" 
                            width="100%" 
                            height="200"
                            allow="autoplay; fullscreen; picture-in-picture"
                            allowfullscreen>
                        </iframe>` :
                        video.type === 'cloudflare' ?
                        `<iframe
                            src="https://iframe.cloudflarestream.com/${video.videoId}"
                            style="border: none; width: 100%; height: 200px;"
                            allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
                            allowfullscreen="true"
                            data-video-type="cloudflare"
                        ></iframe>` :
                        `<video controls preload="metadata" onplay="addToHistory('${video.id}')" onended="playNextVideo(this.closest('.video-card'))">
                            <source src="${video.url}" type="${video.url.endsWith('.mov') ? 'video/quicktime' : 'video/mp4'}">
                        </video>`
                    }
                    <div class="video-info">
                        <h3>${video.title}</h3>
                        <p>${video.description}</p>
                        <div class="video-meta">
                            ${video.views ? `<span>${video.views} views</span><span>•</span>` : ''}
                            ${video.channel ? `<span>${video.channel}</span>` : ''}
                            ${video.duration ? `<span>${video.duration}</span>` : ''}
                            <span class="category">${video.category}</span>
                        </div>
                        <div class="video-controls">
                            <button class="control-btn ${favoriteVideos.includes(video.id) ? 'active' : ''}" onclick="toggleFavorite('${video.id}')">
                                <i class="fas fa-heart"></i>
                                <span>Favorite</span>
                            </button>
                            <button class="control-btn ${autoplayEnabled ? 'active' : ''}" onclick="toggleAutoplay()">
                                <i class="fas ${autoplayEnabled ? 'fa-pause-circle' : 'fa-play-circle'}"></i>
                                <span>Autoplay ${autoplayEnabled ? 'On' : 'Off'}</span>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            setupVideoPlayers();
        }

        function displayTrending() {
            const trendingGrid = document.querySelector('.trending-grid');
            const trendingVideos = videos.filter(v => v.trending);
            trendingGrid.innerHTML = trendingVideos.map(video => `
                <div class="video-card">
                    ${video.type === 'embed' ? 
                        `<iframe src="${video.embedUrl}?sharing-enable=false&ui-logo=false&ui-start-screen-info=false" 
                            frameborder="0" 
                            width="100%" 
                            height="200"
                            allow="autoplay; fullscreen; picture-in-picture"
                            allowfullscreen>
                        </iframe>` :
                        video.type === 'cloudflare' ?
                        `<iframe
                            src="https://iframe.cloudflarestream.com/${video.videoId}"
                            style="border: none; width: 100%; height: 200px;"
                            allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
                            allowfullscreen="true"
                            data-video-type="cloudflare"
                        ></iframe>` :
                        `<video controls preload="metadata" onplay="addToHistory('${video.id}')" onended="playNextVideo(this.closest('.video-card'))">
                            <source src="${video.url}" type="${video.url.endsWith('.mov') ? 'video/quicktime' : 'video/mp4'}">
                        </video>`
                    }
                    <div class="video-info">
                        <h3>${video.title}</h3>
                        <p>${video.description}</p>
                        <div class="video-meta">
                            <span>${video.views} views</span>
                            <span>•</span>
                            <span>Trending #${trendingVideos.indexOf(video) + 1}</span>
                        </div>
                        <div class="video-controls">
                            <button class="control-btn ${favoriteVideos.includes(video.id) ? 'active' : ''}" onclick="toggleFavorite('${video.id}')">
                                <i class="fas fa-heart"></i>
                                <span>Favorite</span>
                            </button>
                            <button class="control-btn ${autoplayEnabled ? 'active' : ''}" onclick="toggleAutoplay()">
                                <i class="fas ${autoplayEnabled ? 'fa-pause-circle' : 'fa-play-circle'}"></i>
                                <span>Autoplay ${autoplayEnabled ? 'On' : 'Off'}</span>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            setupVideoPlayers();
        }

        function displayHistory() {
            const historyContainer = document.getElementById('watchHistory');
            if (watchHistory.length === 0) {
                historyContainer.innerHTML = '<p class="empty-message">No watch history</p>';
                return;
            }

            historyContainer.innerHTML = watchHistory.map(videoId => {
                const video = videos.find(v => v.id === videoId);
                return `
                    <div class="video-card">
                        ${video.type === 'embed' ? 
                            `<iframe src="${video.embedUrl}?sharing-enable=false&ui-logo=false&ui-start-screen-info=false" 
                                frameborder="0" 
                                width="100%" 
                                height="200"
                                allow="autoplay; fullscreen; picture-in-picture"
                                allowfullscreen>
                            </iframe>` :
                            video.type === 'cloudflare' ?
                            `<iframe
                                src="https://iframe.cloudflarestream.com/${video.videoId}"
                                style="border: none; width: 100%; height: 200px;"
                                allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
                                allowfullscreen="true"
                            ></iframe>` :
                            video.type === 'dailymotion' ?
                            `<iframe
                                src="https://www.dailymotion.com/embed/video/${video.id}"
                                style="border: none; width: 100%; height: 200px;"
                                allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen>
                            </iframe>` :
                            `<video controls preload="metadata">
                                <source src="${video.url}" type="${video.url.endsWith('.mov') ? 'video/quicktime' : 'video/mp4'}">
                            </video>`
                        }
                        <div class="video-info">
                            <h3>${video.title}</h3>
                            <div class="video-meta">
                                <span>Watched recently</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            setupVideoPlayers();
        }

        function displayLibrary() {
            // Update Watch Later
            const watchLaterContainer = document.getElementById('watchLater');
            watchLaterContainer.innerHTML = watchLater.length ? watchLater.map(videoId => {
                const video = videos.find(v => v.id === videoId);
                return `
                    <div class="video-card">
                        ${video.type === 'embed' ? 
                            `<iframe src="${video.embedUrl}?sharing-enable=false&ui-logo=false&ui-start-screen-info=false" 
                                frameborder="0" 
                                width="100%" 
                                height="200"
                                allow="autoplay; fullscreen; picture-in-picture"
                                allowfullscreen>
                            </iframe>` :
                            video.type === 'cloudflare' ?
                            `<iframe
                                src="https://iframe.cloudflarestream.com/${video.videoId}"
                                style="border: none; width: 100%; height: 200px;"
                                allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
                                allowfullscreen="true"
                            ></iframe>` :
                            video.type === 'dailymotion' ?
                            `<iframe
                                src="https://www.dailymotion.com/embed/video/${video.id}"
                                style="border: none; width: 100%; height: 200px;"
                                allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen>
                            </iframe>` :
                            `<video controls preload="metadata">
                                <source src="${video.url}" type="${video.url.endsWith('.mov') ? 'video/quicktime' : 'video/mp4'}">
                            </video>`
                        }
                        <div class="video-info">
                            <h3>${video.title}</h3>
                        </div>
                    </div>
                `;
            }).join('') : '<p class="empty-message">No videos added to Watch Later</p>';

            // Update Liked Videos
            const likedContainer = document.getElementById('likedVideos');
            likedContainer.innerHTML = likedVideos.length ? likedVideos.map(videoId => {
                const video = videos.find(v => v.id === videoId);
                return `
                    <div class="video-card">
                        ${video.type === 'embed' ? 
                            `<iframe src="${video.embedUrl}?sharing-enable=false&ui-logo=false&ui-start-screen-info=false" 
                                frameborder="0" 
                                width="100%" 
                                height="200"
                                allow="autoplay; fullscreen; picture-in-picture"
                                allowfullscreen>
                            </iframe>` :
                            video.type === 'cloudflare' ?
                            `<iframe
                                src="https://iframe.cloudflarestream.com/${video.videoId}"
                                style="border: none; width: 100%; height: 200px;"
                                allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
                                allowfullscreen="true"
                            ></iframe>` :
                            video.type === 'dailymotion' ?
                            `<iframe
                                src="https://www.dailymotion.com/embed/video/${video.id}"
                                style="border: none; width: 100%; height: 200px;"
                                allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen>
                            </iframe>` :
                            `<video controls preload="metadata">
                                <source src="${video.url}" type="${video.url.endsWith('.mov') ? 'video/quicktime' : 'video/mp4'}">
                            </video>`
                        }
                        <div class="video-info">
                            <h3>${video.title}</h3>
                        </div>
                    </div>
                `;
            }).join('') : '<p class="empty-message">No liked videos yet</p>';

            setupVideoPlayers();
        }

        function addToHistory(videoId) {
            if (!watchHistory.includes(videoId)) {
                watchHistory.unshift(videoId);
                // Keep only last 10 videos
                watchHistory = watchHistory.slice(0, 10);
            }
        }

        function clearHistory() {
            watchHistory = [];
            displayHistory();
        }

        function setupVideoPlayers() {
            const videoCards = document.querySelectorAll('.video-card');
            videoCards.forEach(card => {
                const video = videos.find(v => v.id === card.dataset.videoId);
                if (!video) return;

                let playerHtml = '';
                if (video.type === 'cloudflare') {
                    playerHtml = `<iframe src="https://iframe.cloudflarestream.com/${video.id}" allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;" allowfullscreen></iframe>`;
                } else if (video.type === 'dailymotion') {
                    playerHtml = `<iframe src="https://www.dailymotion.com/embed/video/${video.id}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
                }

                const playerContainer = card.querySelector('.video-player');
                if (playerContainer) {
                    playerContainer.innerHTML = playerHtml;
                }
            });

            // Handle HTML5 video elements
            document.querySelectorAll('video').forEach(video => {
                video.addEventListener('play', () => {
                    document.querySelectorAll('video').forEach(otherVideo => {
                        if (otherVideo !== video) otherVideo.pause();
                    });
                });
                
                video.addEventListener('ended', () => {
                    playNextVideo(video.closest('.video-card'));
                });
            });

            // Handle embedded iframes (Cloudflare and Dailymotion)
            document.querySelectorAll('iframe').forEach(iframe => {
                iframe.addEventListener('load', () => {
                    // Add message listener for video events
                    window.addEventListener('message', (event) => {
                        // Handle Cloudflare Stream events
                        if (event.data.event === 'videoEnded') {
                            playNextVideo(iframe.closest('.video-card'));
                        }
                        // Handle Dailymotion events
                        if (event.data.event === 'ended') {
                            playNextVideo(iframe.closest('.video-card'));
                        }
                    });
                });
            });
        }

        function playNextVideo(currentVideoCard) {
            if (!autoplayEnabled) return;
            
            const nextVideoCard = currentVideoCard.nextElementSibling;
            
            if (nextVideoCard) {
                const nextVideo = nextVideoCard.querySelector('video');
                const nextIframe = nextVideoCard.querySelector('iframe');
                
                if (nextVideo) {
                    nextVideo.play();
                } else if (nextIframe) {
                    // For Cloudflare Stream videos
                    if (nextIframe.src.includes('cloudflarestream')) {
                        nextIframe.src = nextIframe.src + '?autoplay=true';
                    }
                    // For Dailymotion videos
                    else if (nextIframe.src.includes('dailymotion')) {
                        nextIframe.src = nextIframe.src + '?autoplay=1';
                    }
                }
                nextVideoCard.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function toggleFavorite(videoId) {
            const index = favoriteVideos.indexOf(videoId);
            if (index === -1) {
                favoriteVideos.push(videoId);
            } else {
                favoriteVideos.splice(index, 1);
            }
            localStorage.setItem('favoriteVideos', JSON.stringify(favoriteVideos));
            displayVideos();
        }

        function toggleAutoplay() {
            autoplayEnabled = !autoplayEnabled;
            localStorage.setItem('autoplayEnabled', autoplayEnabled);
            displayVideos();
        }

        function loadUserPreferences() {
            const savedFavorites = localStorage.getItem('favoriteVideos');
            if (savedFavorites) {
                favoriteVideos = JSON.parse(savedFavorites);
            }

            const savedAutoplay = localStorage.getItem('autoplayEnabled');
            if (savedAutoplay !== null) {
                autoplayEnabled = JSON.parse(savedAutoplay);
            }
        }

        function filterVideos() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filteredVideos = videos.filter(video => 
                video.title.toLowerCase().includes(searchTerm) ||
                video.description.toLowerCase().includes(searchTerm) ||
                video.category.toLowerCase().includes(searchTerm)
            );
            displayVideos();
        }

        // Initialize
        loadUserPreferences();
        displayVideos();
    </script>
</body>
</html>
